<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Home</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
        crossorigin="anonymous">
    <script src="https://unpkg.com/htmx.org@2.0.4"
            integrity="sha384-HGfztofotfshcF7+8n44JQL2oJmowVChPTg48S+jvZoztPfvwD79OC/LTtG6dMp+"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>
<body>
    <div class="container-fluid" style="background-color: #FDF4FE">
        <div class="row">
            <div class="col-md-2 p-0">
                <div th:replace="~{navbar :: sidebar('home')}"></div>
            </div>

            <div class="col-md-10">
                <div class="align-items-center justify-content-center flex-grow-1">
                    <div class="row">
                        <div class="col-md-6 p-3">
                            <div>
                                <div>
                                    <h5>Today's expense</h5>
                                </div>
                                <div class="border rounded-4">
                                    <canvas id="expenseChart"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 p-3">
                            <div>
                                <div>
                                    <h5>Today's income</h5>
                                </div>
                                <div class="border rounded-4">
                                    <canvas id="incomeChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            try {
                const res = await fetch("/homeGraph")
                const data = await res.json()
                console.log("Data:", data)


                const incomeData = data
                    .filter(item => item.income > 0)
                const incomeChartData = {
                    labels: incomeData.map(item => item.categoryDetails.name),
                    datasets: [{
                        data: incomeData.map(item => item.income),
                        backgroundColor: incomeData.map(item => item.categoryDetails.color)
                    }]
                };

                const expenseData = data
                    .filter(item => item.expense > 0)
                const expenseChartData = {
                    labels: expenseData.map(item => item.categoryDetails.name),
                    datasets: [{
                        data: expenseData.map(item => item.expense),
                        backgroundColor: expenseData.map(item => item.categoryDetails.color)
                    }]
                };


                new Chart(document.getElementById("incomeChart"), {
                    type: "doughnut",
                    data: incomeChartData,

                })

                new Chart(document.getElementById("expenseChart"), {
                    type: "doughnut",
                    data: expenseChartData,
                })


            } catch (err) {
                console.error("Fetch error:", err);
            }
        })

    </script>

</body>
</html>